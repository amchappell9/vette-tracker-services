# Docker Instructions

## Building

Build image:
`docker build --tag vette-tracker-services .`

To see a list of images:
`docker images`

You should see an image named `vette-tracker-services`.

To remove an image:
`docker rmi vette-tracker-services`

To build multistage image:
`docker build -t vette-tracker-services:multistage -f Dockerfile.multistage .`

## Running

To run image:
`docker run -p 8080:8080 vette-tracker-services`

To run in detached mode:
`docker run -d -p 8080:8080 --name rest-server vette-tracker-services`

To run the multistage image in detached mode:
`docker run -d -p 8080:8080 --name rest-server vette-tracker-services:multistage`s

## Containers

To see the containers that are running on your machine:
`docker ps`

To see all containers:
`docker ps -a`

To stop a container:
`docker stop <container_id>`

To remove a container:
`docker rm <container_id>`

## Storage

Volumes are the preferred mechanism for persisting data generated by and used by Docker containers.

When using Docker Compose, it will handle creating the volume for you (and yell at you if you do it)

To view list of volumes:
`docker volume list`

To create a new volume:
`docker volume create pg-vette-services`

## Networking

The rest services and the database need to communicate with each other over a network. To start, a user-defined bridge network will be used. This will provide a DNS lookup service so we can refer to the database by its hostname.

When using Docker Compose, it will handle creating the network for you (and yell at you if you do it)

To create a network:
`docker network create -d bridge vette-services-net`

To view networks:
`docker network list`

## Postgres Database

To run a postgres database:
`docker run --name vette-tracker-db -e POSTGRES_PASSWORD=password -d -p 5432:5432 postgres`

## Docker Compose

To build and run your application using Docker Compose:
`docker compose up --build`

Make sure you have the build flag in there to ensure rebuilds happen when the source code changes.

## How to log into the db running in the container

## Postgres Commands

Connect to the database:
`docker exec -it vette-services-pg-db psql -U postgres -d vettetracker`

View all databases:
`\l`
